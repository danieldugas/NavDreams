import dynamic_window
import numpy as np
from matplotlib import pyplot as plt
from timeit import default_timer as timer

r = np.array(
[0.0, 0.0, 0.0, 4.410961627960205, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 5.628666877746582, 5.581516265869141, 0.0, 0.0, 5.634013652801514, 5.643829345703125, 5.6796369552612305, 1.806106448173523, 1.7899017333984375, 1.7916847467422485, 1.7754663228988647, 1.779996395111084, 1.7867485284805298, 1.7874958515167236, 1.7882356643676758, 1.7839704751968384, 1.781697392463684, 1.7771297693252563, 1.78482985496521, 1.7965199947357178, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.5923316478729248, 1.600858449935913, 1.6143689155578613, 1.617889165878296, 1.6263929605484009, 1.6239094734191895, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4.85136604309082, 0.0, 0.0, 4.776109218597412, 4.760526180267334, 0.0, 0.0, 4.708735942840576, 4.697123050689697, 4.6775054931640625, 4.661880016326904, 4.644247055053711, 4.631606101989746, 4.6179585456848145, 4.60430383682251, 4.587643146514893, 4.560298919677734, 4.550614833831787, 4.577909469604492, 4.497239112854004, 4.432557106018066, 4.4078521728515625, 4.393136978149414, 4.379414081573486, 4.3716816902160645, 4.3689398765563965, 4.366191387176514, 4.370431900024414, 4.3856611251831055, 4.40687894821167, 4.409100532531738, 4.374541282653809, 4.361750602722168, 4.353950023651123, 4.344143390655518, 4.33333158493042, 4.326510429382324, 4.315685272216797, 4.307851791381836, 4.296014785766602, 4.284170627593994, 4.277317523956299, 4.269458293914795, 4.256596088409424, 4.249722957611084, 4.239846706390381, 4.231962203979492, 4.21917200088501, 0.36836907267570496, 4.204358100891113, 4.194444179534912, 4.186522483825684, 4.182590961456299, 4.174657344818115, 4.167716026306152, 4.160768985748291, 4.150818824768066, 4.14385986328125, 4.135895729064941, 4.134919166564941, 4.130939483642578, 0.5376407504081726, 0.5282713174819946, 4.114969253540039, 0.5115500688552856, 0.5260133743286133, 0.5232110619544983, 0.5102507472038269, 0.5045124888420105, 0.5161226987838745, 4.071793079376221, 4.060751438140869, 0.5090914964675903, 0.4466721713542938, 0.5004437565803528, 0.5113459825515747, 0.5173046588897705, 0.5116104483604431, 0.711115300655365, 0.5091976523399353, 0.5089677572250366, 0.8099697232246399, 0.5148650407791138, 0.49618297815322876, 0.5123685002326965, 0.511236310005188, 4.041172504425049, 4.042025566101074, 4.04187536239624, 4.030734062194824, 4.038563251495361, 4.037398815155029, 4.0342326164245605, 4.026067733764648, 4.031879425048828, 4.03369140625, 4.0325026512146, 4.033306121826172, 4.035103797912598, 4.0348992347717285, 4.031694412231445, 4.032479286193848, 4.034257888793945, 4.035033702850342, 4.034805774688721, 4.02159309387207, 4.026349067687988, 4.03209924697876, 4.010885715484619, 3.9886696338653564, 3.9881582260131836, 3.987895965576172, 3.996615171432495, 3.9983413219451904, 3.9960696697235107, 4.014760494232178, 4.010483741760254, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.6429286003112793, 3.6422619819641113, 3.649583339691162, 3.6549112796783447, 3.652256965637207, 3.647609233856201, 3.6609301567077637, 3.6682651042938232, 3.6726083755493164, 3.68593692779541, 3.698269844055176, 3.6976301670074463, 3.696993112564087, 3.693364143371582, 3.708700656890869, 3.709068536758423, 3.7084407806396484, 0.0, 0.0, 3.231881856918335, 3.1644392013549805, 3.118263006210327, 3.131788969039917, 3.1326792240142822, 3.154008388519287, 3.1783318519592285, 3.7911012172698975, 3.788498640060425, 3.342973470687866, 3.304640054702759, 3.2802670001983643, 3.278825521469116, 3.2733943462371826, 3.2759382724761963, 3.2886173725128174, 3.291015863418579, 3.306381940841675, 3.4500958919525146, 3.909679889678955, 3.9130821228027344, 3.9274652004241943, 3.937856674194336, 3.9402639865875244, 3.950657844543457, 3.984116554260254, 3.9774367809295654, 4.004802227020264, 4.008211612701416, 4.012620449066162, 4.024017810821533, 4.042402744293213, 4.047811508178711, 4.073185443878174, 4.080591678619385, 4.088996887207031, 4.110379695892334, 4.1177873611450195, 4.123198986053467, 4.131605625152588, 4.16596794128418, 4.213696002960205, 4.224208354949951, 4.215571403503418, 4.254218578338623, 4.260738849639893, 4.277241230010986, 4.283146381378174, 4.317512035369873, 4.331909656524658, 4.357289791107178, 4.367693901062012, 4.360125541687012, 4.407471179962158, 4.412882328033447, 4.431272029876709, 4.472628116607666, 4.47504186630249, 4.526709079742432, 4.532238006591797, 3.430589437484741, 3.6376140117645264, 3.628175735473633, 3.6217310428619385, 3.6093015670776367, 3.621814727783203, 3.64046311378479, 3.6672539710998535, 3.807492971420288, 3.8369786739349365, 3.857485055923462, 3.881396770477295, 3.888784885406494, 5.575098991394043, 0.0, 0.0, 0.0, 5.581733703613281, 5.614039897918701, 5.655392646789551, 5.695745944976807, 5.725107192993164, 5.758463382720947, 5.789820671081543, 5.8271708488464355, 5.883007049560547, 5.921552658081055, 5.971562385559082, 6.010903358459473, 6.049243927001953, 6.086583614349365, 6.1249213218688965, 6.15925931930542, 6.204587936401367, 6.242919921875, 6.292242527008057, 6.330570220947266, 6.369896411895752, 6.415215492248535, 6.474524021148682, 6.470871448516846, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.2912797927856445, 3.2816288471221924, 3.2659902572631836, 3.255336284637451, 3.2626330852508545, 3.2709250450134277, 3.3742916584014893, 3.3755927085876465, 3.3788859844207764, 3.381178140640259, 4.674230575561523, 4.682510852813721, 4.647838592529297, 4.67109489440918, 4.672372817993164, 4.626702308654785, 4.646951675415039, 4.671192169189453, 4.640492916107178, 4.6517415046691895, 8.36971378326416, 8.369965553283691, 8.439190864562988, 8.493416786193848, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 10.30832576751709, 10.356492042541504, 0.0, 0.0, 0.0, 11.102015495300293, 11.138161659240723, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4.367449760437012, 4.371410369873047, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 7.6178812980651855, 7.806378364562988, 7.918115139007568, 11.065552711486816, 11.06629753112793, 11.079035758972168, 11.073766708374023, 11.083208084106445, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 11.172500610351562, 11.195111274719238, 0.0, 0.0, 0.0, 0.0, 19.47443389892578, 0.0, 0.0, 7.285402774810791, 7.26694917678833, 7.265487194061279, 7.289015293121338, 7.143549919128418, 5.347258567810059, 5.282769680023193, 5.250268459320068, 0.0, 0.0, 0.0, 0.0, 5.228630065917969, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 10.260727882385254, 0.0, 9.054180145263672, 8.96038818359375, 8.861589431762695, 8.74978256225586, 8.657967567443848, 8.64514446258545, 8.651312828063965, 0.0, 3.8195278644561768, 8.492769241333008, 8.512906074523926, 8.530034065246582, 8.565155029296875, 8.585267066955566, 8.58337116241455, 8.62646770477295, 8.713555335998535, 8.756636619567871, 0.0, 0.0, 4.070835113525391, 4.057881832122803, 4.055920600891113, 4.0599517822265625, 4.060975551605225, 4.075991153717041, 3.3369994163513184, 0.0, 0.0, 0.0, 0.0, 0.0, 4.0128374099731445, 4.745781421661377, 6.457714557647705, 6.402644157409668, 4.608571529388428, 6.306478023529053, 6.266383171081543, 6.247280120849609, 6.265169143676758, 6.280050277709961, 6.241923809051514, 6.2057905197143555, 6.159648418426514, 6.144498348236084, 6.165339946746826, 6.183173656463623, 6.212998867034912, 6.236817359924316, 6.275627136230469, 6.289429187774658, 6.352008819580078, 6.4547858238220215, 6.487555980682373, 6.515318393707275, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 5.671567440032959, 0.0, 0.0, 5.635513782501221, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4.860352516174316, 4.8428635597229, 4.823367595672607, 4.805863857269287, 4.761359214782715, 4.6758551597595215, 4.630337238311768, 4.613806247711182, 4.598268032073975, 4.577723503112793, 4.562171459197998, 4.544612407684326, 0.0, 4.5028910636901855, 0.0, 4.467710971832275, 4.458108425140381, 4.437501907348633, 3.79250431060791, 3.617960214614868, 3.595338821411133, 3.587702751159668, 3.5760622024536133, 3.574409246444702, 3.5747482776641846, 3.7919607162475586, 0.0, 4.387009620666504, 4.400314807891846, 4.392621994018555, 4.366220951080322, 4.373501300811768, 0.0, 0.0, 3.620999813079834, 3.623255729675293, 3.6305012702941895, 3.6327438354492188, 0.0, 0.0, 4.548664569854736, 6.386828422546387, 4.556085109710693, 0.0, 0.0, 0.0, 9.384117126464844, 9.372295379638672, 9.306473731994629, 9.310637474060059, 9.2608003616333, 9.233955383300781, 9.198103904724121, 5.518360137939453, 5.49150276184082, 5.497625350952148, 5.4807515144348145, 0.0, 5.2951531410217285, 5.285253524780273, 5.292338848114014, 0.0, 0.0, 8.987380027770996, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4.288637638092041, 4.278659820556641, 4.270675182342529, 4.263683795928955, 4.264679908752441, 4.261674404144287, 4.260660648345947, 4.243656635284424, 4.244631290435791, 4.2356085777282715, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4.218531608581543, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.9160702228546143, 3.9129018783569336, 3.9107277393341064, 3.9115445613861084, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.8219518661499023, 3.826688528060913, 3.833418130874634, 3.8368825912475586, 3.8366129398345947, 3.83933424949646, 3.8420519828796387, 3.8467628955841064, 3.844482421875, 3.853179454803467, 3.8568811416625977, 3.85958194732666, 3.8612804412841797, 3.899911642074585, 0.0, 3.9634976387023926, 3.9711761474609375, 3.9728612899780273, 3.981531858444214, 3.983210802078247, 3.988879919052124, 3.9965426921844482, 3.9918932914733887, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 12.862844467163086, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.883187174797058, 1.871878981590271, 1.865527629852295, 1.8621493577957153, 1.861743688583374, 1.8633195161819458, 1.8559715747833252, 1.8694415092468262, 1.8819198608398438, 1.8765498399734497, 1.877127766609192, 7.35487699508667, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.8409327268600464, 1.8434809446334839, 1.832152009010315, 1.8267700672149658, 1.8070868253707886, 1.8096321821212769, 1.8131684064865112, 5.0316033363342285, 3.1535983085632324, 4.972831726074219, 4.9634222984313965, 4.922051906585693, 4.8766865730285645, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4.8191022872924805, 4.824557304382324, 4.843992710113525, 4.869419574737549, 4.889853000640869, 4.911284446716309, 4.932714462280273, 4.959137916564941, 4.9775710105896, 5.007987976074219, 5.044396877288818, 5.053837776184082, 5.0822553634643555, 5.105678081512451, 5.2573981285095215, 5.3087873458862305, 5.358564853668213, 5.365614891052246, 6.086811542510986, 6.183173179626465, 6.177616596221924, 6.220020294189453, 0.0, 6.588222980499268, 6.49611234664917, 6.486550331115723, 0.0, 0.0, 6.191577911376953, 0.0, 0.0, 6.256266117095947, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.324414014816284, 2.299931049346924, 0.0, 2.2853903770446777, 0.0, 0.0, 0.0, 6.914459228515625, 2.2444610595703125, 2.2428276538848877, 0.0, 0.0, 0.4587666988372803, 0.0, 0.4674654006958008, 0.4547256827354431, 0.0, 0.45868802070617676, 0.46299615502357483, 0.46683523058891296, 0.0, 0.46523475646972656, 0.4580577611923218, 0.46530482172966003, 0.46575483679771423, 0.46535900235176086, 0.474276065826416, 0.4679235517978668, 0.4789554476737976, 0.4717473089694977, 0.4789401888847351, 0.4895583987236023, 0.49763086438179016, 0.5006112456321716, 0.0, 0.494099497795105, 0.0, 0.0, 0.0, 7.637450695037842, 7.74263334274292, 7.856809139251709, 17.02513313293457, 18.73322296142578, 5.247447967529297, 5.21467399597168, 11.908280372619629, 11.861475944519043, 11.85166072845459, 11.836841583251953, 11.816017150878906, 11.80618667602539, 11.848342895507812, 0.0, 11.97463607788086, 12.121763229370117, 12.318880081176758, 0.0, 13.402022361755371, 0.0, 0.613366425037384, 0.0, 0.0, 12.953654289245605, 12.932756423950195, 12.987845420837402, 4.99983549118042, 0.0, 10.565403938293457, 10.584468841552734, 0.0, 12.857306480407715, 0.0, 0.0, 0.5275914669036865, 0.0, 7.991255283355713, 7.973281383514404, 7.96829891204834, 7.9643096923828125, 7.955315589904785, 0.0, 0.0, 7.943292140960693, 7.928274631500244, 0.0, 6.352703094482422, 6.3916497230529785, 0.0, 6.397550582885742, 7.9060211181640625, 7.886959552764893, 7.890887260437012, 7.879811763763428, 7.87672758102417, 7.86563777923584, 7.8645405769348145, 7.871434688568115, 7.863325595855713, 6.272595405578613, 6.288460731506348, 6.28732442855835, 6.288180828094482, 0.45168614387512207, 8.477259635925293, 9.129005432128906, 12.38436222076416, 0.45834577083587646, 0.4609067738056183, 8.712343215942383, 8.654152870178223, 8.624953269958496, 7.936837673187256, 7.59967041015625, 8.063371658325195, 8.167123794555664, 8.045899391174316, 7.943665027618408, 8.337358474731445, 7.57219934463501, 0.0, 8.287557601928711, 8.28327465057373, 8.363974571228027, 0.0, 0.0, 0.0, 8.326743125915527, 8.306418418884277, 8.33008098602295, 8.196752548217773, 8.123409271240234, 8.138050079345703, 8.154684066772461, 0.0, 0.0, 0.0, 7.8211798667907715, 7.787368297576904, 7.804948806762695, 0.0, 9.494976043701172, 7.909640312194824, 8.10517692565918, 8.131718635559082, 0.0, 0.0, 12.792635917663574, 12.808146476745605, 13.03764533996582, 13.124138832092285, 16.534570693969727, 0.0, 15.776535034179688, 15.536002159118652, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 12.022706031799316, 0.0, 0.0, 11.2697172164917, 11.191036224365234, 11.072346687316895, 10.872650146484375, 10.724946022033691, 10.583231925964355, 10.414509773254395, 10.26077938079834, 9.987041473388672, 0.0, 9.872537612915039, 9.770773887634277, 9.645002365112305, 9.5272216796875, 9.415431022644043, 9.304634094238281, 0.0, 9.091014862060547, 8.983192443847656, 0.0, 8.79652214050293, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
).astype(np.float32)
angles = np.linspace(0, 2*np.pi, r.shape[0]+1, dtype=np.float32)[:-1]


# dwa
# Get state
# goal in robot frame
gx = 1.3
gy = -0.5

# robot speed in robot frame
u = 0.2
v = 0.1
w = 0


DWA_DT = 0.5
tic = timer()
best_u, best_v, best_score = dynamic_window.linear_dwa(
    r,
    angles,
    u, v, gx, gy, DWA_DT,
    DV=0.05,
    UMIN=-0.5,
    UMAX=0.5,
    VMIN=-0.5,
    VMAX=0.5,
    AMAX=0.4,
    COMFORT_RADIUS_M=0.5,
    )
toc = timer()
print(best_u * DWA_DT, best_v * DWA_DT, best_score)
print("DWA: {:.2f} Hz".format(1/(toc-tic)))
